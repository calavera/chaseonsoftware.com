---
title: Create Local Plugins for GatsbyJS Projects
description: "Learn how (and why) to create a local plugin for GatsbyJS projects"
date: 2019-01-21
---

# Why did I want to write about this?

- I wanted to use MDX as the format I wrote content in, but the MDX plugin didn't do exactly what I wanted it to. I found that with Gatsby it's really easy to extend functionality with local plugins and decided to give that a spin to get the functionality I wanted.

# What functionality did you want?

I wanted to be able to filter content based on its source type. I use the `gatsby-source-filesystem` plugin that pulls files so that a transformer can take that raw content and convert it. You can give each instance of pulling source a specific name and that name can be used to filter content. As an example, I have 3 different source types:

- `articles` - this comes from the `content/articles` directory. It's the content of my blog that is **ready to be shared**
- `drafts` - this comes from the `drafts` directory. It's the content of my blog that I'm working on and I don't want published to my live site but may want deployed on a non-master a branch deploy.
- `pages` - this comes from the `content/pages` directory. It's the "evergreen" content for my website (it includes things like "About" as well as sections such as my "Useful Git Commands" page).

In my `index.js` I only want `articles` to be displayed, so I needed to be able to use a GraphQL query that could filter the results to _only_ articles if it's production and `articles` and `drafts` for non-production requests.

## Why Create A Local Plugin?

## How To Create A Local Plugin?

- create a `plugins` directory
- initialize a subdirectory as an npm package
- add name of package to `gatsby-config.js`

This week I changed the Gatsby transformer for my blog from the Remark (Markdown) transformer to the Mdx (mdx) transformer plugin.

I noticed that when I did that pages started to show up in my index and realized it was because the filter I had in my index was to remove any of the content that was a pageType of type "pages".

I have 3 types of source providers: articles (things that I write), pages (evergreen-ish high-level pages) and drafts (stuff no one sees until I put in articles). I was setting the pageType through the source provider, but Mdx doesn't have support for those fields and I'm not quite ready to create a plugin for it (although I might!), so I wanted to do something quick and dirty.

# Creating a Local Plugin

This is where local plugins come into play. A local plugin is just what it sounds like: rather than installing a package from npm for a plugin, you can create a plugin in your repository that can live with the rest of your Gatsby blog's post.

Gatsby knows to look in the `plugins` directory for a plugin directory. For my example, I wanted to create a plugin that would add source instances to the MDX nodes, so I ran the following from my project root:

```sh
mkdir -p plugins/gatsby-source-instance-name-mdx && cd !$ && npm init
```

It did 3 things:

- created the directories for `plugins/gatsby-source-instance-name-mdx`
- changed into that directory
- ran the task for creating a new npm project

It's imperative that this directory be initialized as an npm package (maybe explain why?)

Once that was done, I created file called `gatsby-node.js`:

<!--Insert Code -->

Then, in my `gatsby-config.js` file, I added `gatsby-source-instance-name-mdx` to the plugins array:

```JSON
{
    plugins: [
        `gatsby-source-instance-name-mdx`
    ]
}
```

Now, whenever I start up my development server, I can add a filter for `sourceInstanceName` for `articles` and only get back any Mdx nodes that are articles:

```graphql
{
  allMdx(filter: { fields: { sourceInstanceName: { eq: "articles" } } }) {
    edges {
      node {
        id
        code {
          scope
        }
        fields {
          slug
          sourceInstanceName
        }
        frontmatter {
          slug
          title
          tags
        }
        parent {
          ... on File {
            name
          }
        }
      }
    }
  }
}
```
